#encoding=utf-8

import django
django.setup()
from sefaria.model import *
from sefaria.system.database import db
import re
from sources.local_settings import *
from sources.functions import post_sheet, http_request
from post_sheet import *

GET_SERVER = "http://shmuel.sandbox.sefaria.org"#"http://localhost:8000"
POST_SERVER = "http://shmuel.sandbox.sefaria.org"

def revers_get_map():
    # map_get_id_ssn = {x: x for x in range(1478)}
    map_get_id_ssn = {1: 1461, 2: 1464, 3: 1463, 4: 1470, 5: 1466, 6: 1478, 7: 2907, 8: 1472, 9: 1477, 10: 1479,
                      11: 1462, 12: 1468, 13: 1467, 14: 1474, 15: 1471, 16: 1492, 17: 1489, 18: 1485, 19: 1482,
                      20: 1486, 21: 1465, 22: 1473, 23: 1481, 24: 1480, 25: 1483, 26: 1504, 27: 1511, 28: 1496,
                      29: 1491, 30: 1494, 31: 1469, 32: 1476, 33: 1493, 34: 1488, 35: 1495, 36: 1512, 37: 1518,
                      38: 1501, 39: 1502, 40: 1498, 41: 1475, 42: 1484, 43: 1500, 44: 1497, 45: 1503, 46: 1521,
                      47: 1542, 48: 1505, 49: 1506, 50: 1510, 51: 1487, 52: 1490, 53: 1508, 54: 1509, 55: 1513,
                      56: 1532, 57: 1552, 58: 1515, 59: 1519, 60: 1520, 61: 1507, 62: 1499, 63: 1523, 64: 1514,
                      65: 1524, 67: 1564, 68: 1526, 70: 1527, 71: 1516, 72: 1517, 73: 1528, 74: 1522, 75: 1534,
                      76: 1545, 77: 1575, 78: 1531, 79: 1525, 80: 1537, 81: 1536, 82: 1529, 83: 1543, 84: 1533,
                      85: 1544, 86: 1553, 87: 1581, 88: 1539, 89: 1530, 90: 1550, 91: 1538, 92: 1535, 93: 1546,
                      94: 1541, 95: 1554, 96: 1561, 97: 1600, 98: 1548, 99: 1540, 100: 1558, 101: 1555, 102: 1573,
                      103: 1551, 104: 1547, 105: 1566, 106: 1574, 107: 1607, 108: 1559, 109: 1549, 110: 1563, 111: 1571,
                      112: 1603, 113: 1565, 114: 1557, 115: 1579, 116: 1585, 117: 1613, 118: 1569, 119: 1556, 120: 1577,
                      121: 1580, 122: 1621, 123: 1570, 124: 1560, 125: 1588, 126: 1592, 127: 1619, 128: 1576, 129: 1562,
                      130: 1583, 131: 1589, 132: 1629, 133: 1578, 134: 1567, 135: 1596, 136: 1602, 137: 1630, 138: 1584,
                      139: 1568, 140: 1591, 141: 1598, 142: 1640, 143: 1586, 144: 1572, 145: 1609, 146: 1617, 147: 1634,
                      148: 1594, 149: 1582, 150: 1604, 151: 1605, 152: 1650, 153: 1599, 154: 1587, 155: 1620, 156: 1628,
                      157: 1646, 158: 1597, 159: 1593, 160: 1611, 161: 1614, 162: 1660, 163: 1606, 164: 1590, 165: 1625,
                      166: 1636, 167: 1651, 168: 1601, 169: 1643, 170: 1612, 171: 1622, 172: 1676, 173: 1627, 174: 1595,
                      175: 1626, 176: 1647, 177: 1655, 178: 1610, 179: 1667, 180: 1618, 181: 1631, 182: 1680, 183: 1641,
                      184: 1608, 185: 1633, 186: 1658, 187: 1664, 188: 1616, 189: 1682, 190: 1623, 191: 1632, 192: 1690,
                      193: 1649, 194: 1615, 195: 1645, 196: 1668, 197: 1671, 198: 1624, 199: 1685, 200: 1635, 201: 1637,
                      202: 1705, 203: 1656, 204: 1638, 206: 1683, 207: 1677, 208: 1648, 209: 1695, 210: 1644, 211: 1639,
                      212: 1718, 213: 1666, 214: 1642, 215: 1654, 216: 1693, 217: 1688, 218: 1659, 219: 1711, 220: 1653,
                      221: 1652, 222: 1733, 223: 1669, 224: 2908, 225: 1662, 226: 1703, 227: 1702, 228: 1672, 229: 1717,
                      230: 1674, 231: 1657, 232: 2909, 233: 1679, 234: 1661, 235: 1675, 236: 1714, 237: 1710, 238: 1681,
                      239: 1728, 240: 1687, 241: 1663, 242: 1748, 243: 1694, 244: 1670, 245: 1678, 246: 1721, 247: 1716,
                      248: 1691, 249: 1734, 250: 1692, 251: 1665, 252: 1756, 253: 1701, 254: 1686, 255: 1689, 256: 1726,
                      257: 1725, 258: 1699, 259: 1737, 260: 1698, 261: 1673, 262: 1759, 263: 1712, 264: 1696, 265: 1700,
                      266: 1738, 267: 1735, 268: 1706, 269: 1744, 270: 1729, 271: 1684, 272: 1763, 273: 1732, 274: 1704,
                      275: 1708, 276: 1745, 277: 1739, 278: 1709, 279: 1753, 280: 1746, 281: 1697, 282: 1772, 283: 1741,
                      284: 1715, 285: 1719, 286: 1747, 287: 1751, 288: 1723, 289: 1768, 290: 1764, 291: 1707, 292: 1779,
                      293: 1755, 294: 1722, 295: 1724, 296: 1795, 297: 1754, 298: 1781, 299: 1771, 300: 1773, 301: 1713,
                      302: 1789, 303: 1765, 304: 1736, 305: 1731, 306: 1804, 307: 1762, 308: 1790, 309: 1778, 310: 1780,
                      311: 1720, 312: 1797, 313: 1818, 314: 1740, 315: 1743, 316: 1855, 317: 1770, 318: 1800, 319: 1785,
                      320: 1786, 321: 1727, 322: 1813, 323: 1832, 324: 1749, 325: 1752, 326: 1861, 327: 1777, 328: 1807,
                      329: 1788, 330: 1793, 331: 1730, 332: 1819, 333: 1837, 334: 1757, 335: 1758, 336: 1877, 337: 1784,
                      338: 1823, 339: 1794, 340: 1803, 341: 1742, 342: 1826, 343: 1847, 344: 1760, 345: 1766, 346: 1892,
                      347: 1796, 348: 1835, 349: 1802, 350: 1810, 351: 1750, 352: 1830, 353: 1854, 354: 1767, 355: 1776,
                      356: 1897, 357: 1808, 358: 1844, 359: 1811, 360: 1821, 361: 1761, 362: 1840, 363: 1979, 364: 1774,
                      365: 1799, 366: 1958, 367: 1814, 368: 1857, 369: 1822, 370: 1841, 371: 1769, 372: 1849, 373: 1989,
                      374: 1782, 375: 1809, 376: 1970, 377: 1816, 378: 1863, 379: 1829, 380: 1850, 381: 1775, 382: 1862,
                      383: 2005, 384: 1792, 385: 1817, 386: 1976, 387: 1824, 388: 1872, 389: 1842, 390: 1856, 391: 1783,
                      392: 1869, 393: 2012, 394: 1801, 395: 1827, 396: 1988, 397: 1828, 398: 1873, 399: 1848, 400: 1864,
                      401: 1787, 402: 1888, 403: 2020, 404: 1806, 405: 1836, 406: 2007, 407: 1838, 408: 1885, 409: 1858,
                      410: 1874, 411: 1791, 412: 1896, 413: 2033, 414: 1812, 415: 1843, 416: 2014, 417: 1845, 418: 1887,
                      419: 1876, 420: 1881, 421: 1798, 422: 1904, 423: 2038, 424: 1825, 425: 1852, 426: 2027, 427: 1868,
                      428: 1894, 429: 1883, 430: 1889, 431: 1805, 432: 1913, 433: 2050, 434: 1833, 435: 1866, 436: 2036,
                      437: 1879, 438: 1905, 439: 1893, 440: 1901, 441: 1815, 442: 1921, 443: 2057, 444: 1846, 445: 1884,
                      446: 2079, 447: 1891, 448: 1912, 449: 1902, 450: 1910, 451: 1820, 452: 1933, 453: 2070, 454: 1851,
                      455: 1886, 456: 2085, 457: 1899, 458: 1925, 459: 1907, 460: 1918, 461: 1831, 462: 1941, 463: 2163,
                      464: 1859, 465: 1895, 466: 2088, 467: 1909, 468: 1932, 469: 1916, 470: 1924, 471: 1834, 472: 1955,
                      473: 2176, 474: 1865, 475: 1898, 476: 2092, 477: 1926, 478: 1939, 479: 1935, 480: 1929, 481: 1839,
                      482: 1963, 483: 2186, 484: 1871, 485: 1903, 486: 2100, 487: 1930, 488: 1946, 489: 1944, 490: 1937,
                      491: 1853, 492: 1972, 493: 2195, 494: 1878, 495: 1911, 496: 2104, 497: 1945, 498: 1956, 499: 1949,
                      500: 1942, 501: 1860, 502: 1980, 503: 2196, 504: 1882, 505: 1915, 506: 2111, 507: 1950, 508: 1969,
                      509: 1954, 510: 1948, 511: 1867, 512: 1984, 513: 2200, 514: 1890, 515: 1919, 516: 2119, 517: 1964,
                      518: 1977, 519: 1960, 520: 1952, 521: 1870, 522: 1990, 523: 2212, 524: 2910, 525: 1923, 526: 2131,
                      527: 2001, 528: 1991, 529: 1968, 530: 1962, 531: 1875, 532: 1992, 533: 2218, 534: 1908, 535: 1927,
                      536: 2138, 537: 2009, 538: 1995, 539: 1978, 540: 1971, 541: 1880, 542: 1996, 543: 2224, 544: 1914,
                      545: 1928, 546: 2141, 547: 2017, 548: 1999, 549: 1986, 550: 1974, 551: 2911, 552: 2004, 553: 2241,
                      554: 1920, 555: 1938, 556: 2152, 557: 2032, 558: 2030, 559: 2000, 560: 1981, 561: 1900, 562: 2024,
                      563: 2248, 564: 1931, 565: 1953, 566: 2912, 567: 2034, 568: 2039, 569: 2010, 570: 2002, 571: 1906,
                      572: 2035, 573: 2261, 574: 1940, 575: 1961, 576: 2181, 577: 2045, 579: 2023, 580: 2019, 581: 1917,
                      582: 2041, 583: 2267, 584: 1947, 585: 1967, 586: 2185, 587: 2046, 588: 2054, 589: 2026, 590: 2029,
                      591: 1922, 592: 2048, 593: 2275, 594: 1957, 595: 1975, 596: 2197, 597: 2059, 598: 2060, 599: 2040,
                      600: 2037, 601: 1934, 602: 2056, 603: 2286, 604: 1959, 605: 1983, 606: 2203, 607: 2066, 608: 2069,
                      609: 2047, 610: 2051, 611: 1936, 612: 2063, 613: 2301, 614: 1965, 615: 1987, 616: 2217, 617: 2084,
                      618: 2072, 619: 2058, 620: 2062, 621: 1943, 622: 2071, 623: 2305, 624: 1982, 625: 1998, 626: 2232,
                      628: 2077, 629: 2075, 630: 2074, 631: 1951, 632: 2083, 633: 2913, 634: 1985, 635: 2008, 636: 2242,
                      637: 2096, 638: 2087, 639: 2093, 640: 2081, 641: 1966, 642: 2094, 643: 2321, 644: 1994, 645: 2013,
                      646: 2247, 647: 2101, 648: 2095, 649: 2105, 650: 2086, 651: 1973, 652: 2107, 653: 2334, 654: 1997,
                      655: 2021, 656: 2251, 657: 2108, 658: 2103, 659: 2120, 660: 2097, 661: 1993, 662: 2122, 663: 2340,
                      664: 2003, 665: 2025, 666: 2256, 667: 2118, 668: 2117, 669: 2132, 670: 2106, 671: 2006, 672: 2130,
                      673: 2343, 674: 2015, 675: 2031, 676: 2268, 677: 2124, 678: 2125, 679: 2145, 680: 2113, 681: 2011,
                      682: 2136, 683: 2345, 684: 2018, 685: 2044, 686: 2272, 687: 2137, 688: 2135, 689: 2148, 690: 2116,
                      691: 2016, 692: 2146, 693: 2350, 694: 2028, 695: 2049, 696: 2276, 697: 2150, 698: 2144, 699: 2156,
                      700: 2127, 701: 2022, 702: 2154, 703: 2354, 704: 2042, 705: 2055, 706: 2282, 707: 2164, 708: 2151,
                      709: 2162, 710: 2129, 711: 2043, 712: 2158, 713: 2371, 714: 2053, 715: 2061, 716: 2290, 717: 2168,
                      718: 2161, 719: 2170, 720: 2143, 721: 2052, 722: 2175, 723: 2376, 724: 2068, 725: 2064, 726: 2298,
                      727: 2174, 728: 2167, 729: 2179, 730: 2155, 731: 2065, 732: 2177, 733: 2394, 734: 2073, 735: 2067,
                      736: 2306, 737: 2182, 738: 2183, 739: 2184, 740: 2160, 741: 2076, 742: 2188, 743: 2402, 744: 2082,
                      745: 2078, 746: 2315, 747: 2189, 748: 2202, 749: 2206, 750: 2166, 751: 2080, 752: 2201, 753: 2411,
                      754: 2090, 755: 2099, 756: 2316, 757: 2193, 758: 2216, 759: 2209, 760: 2171, 761: 2089, 762: 2211,
                      763: 2413, 764: 2091, 765: 2109, 766: 2326, 767: 2208, 768: 2221, 769: 2214, 770: 2180, 771: 2102,
                      772: 2222, 773: 2415, 774: 2098, 775: 2114, 776: 2339, 777: 2220, 778: 2223, 779: 2226, 780: 2192,
                      781: 2112, 782: 2231, 783: 2423, 784: 2110, 785: 2123, 786: 2344, 787: 2240, 788: 2238, 789: 2230,
                      790: 2205, 791: 2121, 792: 2236, 793: 2431, 794: 2115, 795: 2142, 796: 2347, 797: 2243, 798: 2254,
                      799: 2235, 800: 2210, 801: 2133, 802: 2239, 803: 2439, 804: 2126, 805: 2153, 806: 2356, 807: 2253,
                      808: 2259, 809: 2245, 810: 2215, 811: 2134, 812: 2257, 813: 2445, 814: 2128, 815: 2169, 816: 2361,
                      817: 2265, 818: 2277, 819: 2250, 820: 2228, 821: 2139, 822: 2266, 823: 2452, 824: 2140, 825: 2178,
                      826: 2367, 827: 2273, 828: 2291, 829: 2255, 830: 2234, 831: 2147, 832: 2283, 833: 2461, 834: 2149,
                      835: 2191, 836: 2369, 837: 2288, 838: 2299, 839: 2264, 840: 2246, 841: 2159, 842: 2287, 843: 2466,
                      844: 2157, 845: 2914, 846: 2375, 847: 2297, 848: 2311, 849: 2270, 850: 2260, 851: 2172, 852: 2296,
                      853: 2475, 854: 2165, 855: 2198, 856: 2390, 857: 2303, 858: 2364, 859: 2279, 860: 2274, 861: 2190,
                      862: 2314, 863: 2483, 864: 2173, 865: 2219, 866: 2397, 867: 2308, 868: 2373, 869: 2915, 870: 2284,
                      871: 2199, 872: 2323, 873: 2491, 874: 2187, 875: 2229, 876: 2410, 877: 2322, 878: 2386, 879: 2304,
                      880: 2294, 881: 2207, 882: 2336, 883: 2496, 884: 2194, 885: 2233, 886: 2418, 887: 2327, 888: 2393,
                      889: 2307, 890: 2309, 891: 2213, 892: 2346, 893: 2502, 894: 2204, 895: 2249, 896: 2424, 897: 2333,
                      898: 2401, 899: 2317, 900: 2318, 901: 2225, 902: 2359, 903: 2513, 904: 2227, 905: 2258, 906: 2428,
                      907: 2355, 908: 2405, 909: 2330, 910: 2331, 911: 2244, 912: 2382, 913: 2521, 914: 2237, 915: 2278,
                      916: 2436, 917: 2363, 918: 2406, 919: 2342, 920: 2338, 921: 2263, 922: 2398, 923: 2537, 924: 2252,
                      925: 2289, 926: 2440, 927: 2377, 928: 2422, 929: 2352, 930: 2916, 931: 2269, 932: 2404, 933: 2547,
                      934: 2262, 935: 2295, 936: 2450, 937: 2384, 938: 2437, 939: 2358, 940: 2351, 941: 2280, 942: 2409,
                      943: 2555, 944: 2271, 945: 2310, 946: 2457, 947: 2388, 948: 2451, 949: 2370, 950: 2365, 951: 2292,
                      952: 2419, 953: 2563, 954: 2281, 955: 2320, 956: 2463, 957: 2391, 958: 2458, 959: 2385, 960: 2372,
                      961: 2293, 962: 2435, 963: 2570, 964: 2285, 965: 2325, 966: 2468, 967: 2395, 968: 2459, 969: 2392,
                      970: 2380, 971: 2300, 972: 2446, 973: 2585, 974: 2302, 975: 2335, 976: 2479, 977: 2407, 978: 2465,
                      979: 2408, 980: 2389, 981: 2312, 982: 2454, 983: 2594, 984: 2313, 985: 2348, 986: 2480, 988: 2473,
                      989: 2416, 990: 2403, 991: 2319, 992: 2471, 993: 2600, 994: 2324, 995: 2353, 996: 2489, 997: 2421,
                      998: 2481, 999: 2426, 1000: 2412, 1001: 2329, 1002: 2482, 1003: 2602, 1004: 2328, 1005: 2360,
                      1006: 2494, 1007: 2425, 1008: 2487, 1009: 2433, 1010: 2420, 1011: 2332, 1012: 2503, 1013: 2611,
                      1014: 2337, 1015: 2368, 1016: 2506, 1017: 2430, 1018: 2504, 1019: 2441, 1020: 2434, 1021: 2341,
                      1022: 2523, 1023: 2618, 1024: 2357, 1025: 2374, 1026: 2530, 1027: 2442, 1028: 2510, 1029: 2456,
                      1030: 2438, 1031: 2349, 1032: 2534, 1033: 2633, 1034: 2917, 1035: 2379, 1036: 2546, 1037: 2447,
                      1038: 2519, 1039: 2464, 1040: 2443, 1041: 2362, 1042: 2543, 1043: 2640, 1044: 2378, 1045: 2387,
                      1046: 2553, 1047: 2453, 1048: 2528, 1049: 2474, 1050: 2448, 1051: 2366, 1052: 2551, 1053: 2645,
                      1054: 2383, 1055: 2396, 1056: 2561, 1057: 2469, 1058: 2536, 1059: 2486, 1060: 2449, 1061: 2381,
                      1062: 2556, 1063: 2653, 1064: 2399, 1065: 2427, 1066: 2580, 1067: 2477, 1068: 2544, 1069: 2501,
                      1070: 2467, 1071: 2400, 1072: 2583, 1073: 2662, 1074: 2417, 1075: 2429, 1076: 2592, 1077: 2490,
                      1078: 2562, 1079: 2512, 1080: 2484, 1081: 2414, 1082: 2622, 1083: 2670, 1084: 2432, 1085: 2460,
                      1086: 2613, 1087: 2497, 1088: 2574, 1089: 2516, 1090: 2495, 1091: 2472, 1092: 2629, 1093: 2680,
                      1094: 2444, 1095: 2470, 1096: 2616, 1097: 2505, 1098: 2577, 1099: 2525, 1100: 2509, 1101: 2493,
                      1102: 2639, 1103: 2694, 1104: 2455, 1105: 2485, 1106: 2621, 1107: 2517, 1108: 2589, 1109: 2532,
                      1110: 2520, 1111: 2499, 1112: 2657, 1113: 2697, 1114: 2462, 1115: 2492, 1116: 2627, 1117: 2526,
                      1118: 2591, 1119: 2539, 1120: 2524, 1121: 2508, 1122: 2665, 1123: 2705, 1124: 2476, 1125: 2511,
                      1126: 2632, 1127: 2606, 1128: 2599, 1129: 2550, 1130: 2533, 1131: 2518, 1132: 2674, 1133: 2712,
                      1134: 2478, 1135: 2515, 1136: 2638, 1137: 2612, 1138: 2605, 1139: 2559, 1140: 2541, 1141: 2527,
                      1142: 2682, 1143: 2716, 1144: 2488, 1145: 2522, 1146: 2643, 1147: 2619, 1148: 2610, 1149: 2564,
                      1150: 2548, 1151: 2538, 1152: 2689, 1153: 2720, 1154: 2498, 1155: 2531, 1156: 2647, 1157: 2628,
                      1158: 2615, 1159: 2569, 1160: 2560, 1161: 2540, 1162: 2695, 1163: 2737, 1164: 2500, 1165: 2545,
                      1166: 2658, 1167: 2644, 1168: 2617, 1169: 2578, 1170: 2568, 1171: 2549, 1172: 2701, 1173: 2745,
                      1174: 2507, 1175: 2552, 1176: 2666, 1177: 2650, 1178: 2626, 1179: 2581, 1180: 2573, 1181: 2557,
                      1182: 2708, 1183: 2756, 1184: 2514, 1185: 2558, 1186: 2676, 1187: 2655, 1188: 2634, 1189: 2590,
                      1190: 2579, 1191: 2567, 1192: 2711, 1193: 2760, 1194: 2529, 1195: 2565, 1196: 2679, 1197: 2667,
                      1198: 2642, 1199: 2597, 1200: 2588, 1201: 2571, 1202: 2718, 1203: 2764, 1204: 2535, 1205: 2572,
                      1206: 2693, 1207: 2673, 1208: 2646, 1209: 2601, 1210: 2596, 1211: 2576, 1212: 2725, 1213: 2769,
                      1214: 2542, 1215: 2584, 1216: 2703, 1217: 2681, 1218: 2652, 1219: 2607, 1220: 2603, 1221: 2582,
                      1222: 2733, 1223: 2772, 1224: 2554, 1225: 2593, 1226: 2715, 1227: 2692, 1228: 2656, 1229: 2620,
                      1230: 2609, 1231: 2598, 1232: 2740, 1233: 2781, 1234: 2566, 1235: 2608, 1236: 2728, 1237: 2706,
                      1238: 2664, 1239: 2637, 1240: 2624, 1241: 2614, 1243: 2798, 1244: 2575, 1245: 2625, 1246: 2757,
                      1247: 2724, 1248: 2685, 1249: 2663, 1250: 2651, 1251: 2631, 1252: 2751, 1253: 2806, 1254: 2586,
                      1255: 2649, 1256: 2768, 1257: 2753, 1258: 2704, 1259: 2677, 1260: 2654, 1261: 2635, 1262: 2758,
                      1263: 2810, 1264: 2587, 1265: 2659, 1266: 2773, 1267: 2766, 1268: 2721, 1269: 2698, 1270: 2660,
                      1271: 2641, 1272: 2761, 1273: 2818, 1274: 2595, 1275: 2671, 1276: 2782, 1277: 2774, 1278: 2730,
                      1279: 2717, 1280: 2669, 1281: 2668, 1282: 2767, 1283: 2821, 1284: 2604, 1285: 2683, 1286: 2793,
                      1287: 2777, 1288: 2734, 1289: 2727, 1290: 2687, 1291: 2675, 1292: 2776, 1293: 2825, 1294: 2623,
                      1295: 2686, 1296: 2800, 1297: 2796, 1298: 2748, 1299: 2738, 1300: 2690, 1301: 2684, 1302: 2791,
                      1303: 2836, 1304: 2630, 1305: 2920, 1306: 2807, 1307: 2815, 1308: 2754, 1309: 2743, 1310: 2699,
                      1311: 2691, 1312: 2844, 1313: 2837, 1314: 2636, 1315: 2713, 1316: 2816, 1317: 2822, 1318: 2775,
                      1319: 2759, 1320: 2702, 1321: 2700, 1322: 2851, 1323: 2843, 1324: 2648, 1325: 2726, 1326: 2823,
                      1327: 2827, 1328: 2780, 1329: 2771, 1330: 2710, 1331: 2707, 1332: 2856, 1333: 2845, 1334: 2661,
                      1335: 2735, 1336: 2830, 1337: 2833, 1338: 2787, 1339: 2778, 1340: 2722, 1341: 2714, 1342: 2860,
                      1343: 2847, 1344: 2672, 1345: 2744, 1346: 2835, 1348: 2792, 1349: 2784, 1350: 2729, 1351: 2731,
                      1352: 2867, 1353: 2857, 1354: 2678, 1355: 2750, 1356: 2842, 1357: 2840, 1358: 2803, 1359: 2788,
                      1360: 2741, 1361: 2739, 1362: 2878, 1363: 2866, 1364: 2688, 1365: 2765, 1366: 2854, 1367: 2853,
                      1368: 2812, 1369: 2797, 1370: 2755, 1371: 2749, 1372: 2885, 1373: 2870, 1374: 2696, 1375: 2779,
                      1376: 2863, 1377: 2864, 1378: 2829, 1379: 2804, 1380: 2762, 1381: 2763, 1382: 2890, 1383: 2874,
                      1384: 2709, 1385: 2785, 1386: 2871, 1387: 2868, 1388: 2841, 1389: 2813, 1390: 2770, 1391: 2786,
                      1392: 2898, 1393: 2880, 1394: 2719, 1395: 2789, 1396: 2873, 1397: 2872, 1398: 2846, 1399: 2819,
                      1400: 2783, 1401: 2794, 1402: 2899, 1403: 2884, 1404: 2723, 1405: 2795, 1406: 2875, 1407: 2876,
                      1408: 2849, 1409: 2820, 1410: 2790, 1411: 2805, 1412: 2900, 1413: 2886, 1414: 2732, 1415: 2799,
                      1416: 2879, 1417: 2877, 1418: 2852, 1419: 2826, 1420: 2801, 1421: 2809, 1422: 2901, 1423: 2889,
                      1424: 2736, 1425: 2808, 1426: 2882, 1427: 2881, 1428: 2855, 1429: 2831, 1430: 2802, 1431: 2848,
                      1432: 2902, 1433: 2891, 1434: 2742, 1435: 2918, 1436: 2887, 1437: 2883, 1438: 2859, 1439: 2832,
                      1440: 2811, 1441: 2850, 1442: 2904, 1443: 2894, 1444: 2746, 1445: 2817, 1446: 2892, 1447: 2888,
                      1448: 2861, 1449: 2834, 1450: 2814, 1451: 2858, 1452: 2905, 1455: 2824, 1456: 2896, 1457: 2893,
                      1458: 2865, 1459: 2838, 1461: 2862, 1464: 2747, 1465: 2828, 1466: 2903, 1467: 2895, 1468: 2869,
                      1469: 2839, 1472: 2906, 1473: 2897, 1474: 2752, 1478: 2919
                      }  # this is a map id -> ssn in the server db we are copying from
    reversed_map = dict(zip(map_get_id_ssn.values(), map_get_id_ssn.keys()))
    return reversed_map

def get_ssn(read_id, reversed_get_map):
    """
    gets a sheet id from a server and maps it to the correct ssn (using tags)
    :param read_id: Sheet id
    :return: ssn
    """
    ssn = reversed_get_map.get(int(read_id), 0)
    return ssn

def get_post_id(ssn):
    """
    for the post server gets a ssn and returns the id to which the sheet should be connected. based on the ssn<->id mapping
    on the post server which we learn from the ssn tags
    :param ssn:
    :return:
    """
    map_post_ssn_id = {1: 155157, 2: 155160, 3: 155159, 4: 155166, 5: 155162, 6: 155182, 7: 156601, 8: 155170, 9: 155180, 10: 155185, 11: 155158, 12: 155164, 13: 155163, 14: 155174, 15: 155168, 16: 155212, 17: 155206, 18: 155198, 19: 155191, 20: 155199, 21: 155161, 22: 155172, 23: 155189, 24: 155187, 25: 155193, 26: 155237, 27: 155254, 28: 155221, 29: 155210, 30: 155216, 31: 155165, 32: 155178, 33: 155214, 34: 155204, 35: 155218, 36: 155257, 37: 155266, 38: 155230, 39: 155232, 40: 155225, 41: 155176, 42: 155195, 43: 155229, 44: 155223, 45: 155235, 46: 155273, 47: 155321, 48: 155240, 49: 155243, 50: 155251, 51: 155202, 52: 155208, 53: 155247, 54: 155249, 55: 155259, 56: 155297, 57: 155340, 58: 155262, 59: 155268, 60: 155270, 61: 155245, 62: 155227, 63: 155277, 64: 155260, 65: 155279, 67: 155364, 68: 155283, 70: 155285, 71: 155263, 72: 155264, 73: 155287, 74: 155275, 75: 155302, 76: 155328, 77: 155386, 78: 155294, 79: 155281, 80: 155310, 81: 155308, 82: 155290, 83: 155323, 84: 155299, 85: 155326, 86: 155341, 87: 155397, 88: 155315, 89: 155292, 90: 155338, 91: 155312, 92: 155305, 93: 155330, 94: 155319, 95: 155343, 96: 155357, 97: 155437, 98: 155334, 99: 155317, 100: 155352, 101: 155345, 102: 155382, 103: 155339, 104: 155332, 105: 155368, 106: 155384, 107: 155452, 108: 155354, 109: 155336, 110: 155362, 111: 155377, 112: 155444, 113: 155366, 114: 155349, 115: 155394, 116: 155407, 117: 155462, 118: 155373, 119: 155347, 120: 155390, 121: 155395, 122: 155479, 123: 155376, 124: 155355, 125: 155413, 126: 155422, 127: 155475, 128: 155388, 129: 155360, 130: 155402, 131: 155416, 132: 155495, 133: 155392, 134: 155370, 135: 155430, 136: 155442, 137: 155497, 138: 155404, 139: 155371, 140: 155420, 141: 155434, 142: 155516, 143: 155409, 144: 155379, 145: 155457, 146: 155470, 147: 155505, 148: 155426, 149: 155399, 150: 155447, 151: 155449, 152: 155537, 153: 155436, 154: 155411, 155: 155478, 156: 155492, 157: 155529, 158: 155432, 159: 155424, 160: 155459, 161: 155464, 162: 155559, 163: 155451, 164: 155417, 165: 155486, 166: 155509, 167: 155539, 168: 155440, 169: 155523, 170: 155460, 171: 155481, 172: 155592, 173: 155490, 174: 155428, 175: 155488, 176: 155530, 177: 155548, 178: 155458, 179: 155573, 180: 155473, 181: 155499, 182: 155600, 183: 155519, 184: 155455, 185: 155502, 186: 155555, 187: 155567, 188: 155468, 189: 155605, 190: 155483, 191: 155501, 192: 155624, 193: 155535, 194: 155466, 195: 155527, 196: 155574, 197: 155581, 198: 155485, 199: 155613, 200: 155507, 201: 155510, 202: 155658, 203: 155551, 204: 155512, 206: 155608, 207: 155595, 208: 155532, 209: 155633, 210: 155525, 211: 155514, 212: 155685, 213: 155572, 214: 155521, 215: 155546, 216: 155629, 217: 155619, 218: 155557, 219: 155670, 220: 155543, 221: 155541, 222: 155716, 223: 155577, 224: 156602, 225: 155563, 226: 155652, 227: 155650, 228: 155584, 229: 155682, 230: 155588, 231: 155553, 232: 156603, 233: 155599, 234: 155561, 235: 155591, 236: 155676, 237: 155668, 238: 155602, 239: 155707, 240: 155617, 241: 155565, 242: 155749, 243: 155631, 244: 155579, 245: 155597, 246: 155690, 247: 155680, 248: 155626, 249: 155719, 250: 155627, 251: 155569, 252: 155766, 253: 155647, 254: 155615, 255: 155621, 256: 155703, 257: 155701, 258: 155643, 259: 155727, 260: 155641, 261: 155586, 262: 155773, 263: 155673, 264: 155635, 265: 155646, 266: 155729, 267: 155721, 268: 155660, 269: 155741, 270: 155709, 271: 155610, 272: 155781, 273: 155715, 274: 155655, 275: 155664, 276: 155743, 277: 155731, 278: 155666, 279: 155761, 280: 155745, 281: 155637, 282: 155801, 283: 155735, 284: 155679, 285: 155686, 286: 155747, 287: 155757, 288: 155696, 289: 155793, 290: 155784, 291: 155662, 292: 155814, 293: 155764, 294: 155693, 295: 155699, 296: 155846, 297: 155763, 298: 155819, 299: 155799, 300: 155802, 301: 155675, 302: 155835, 303: 155786, 304: 155724, 305: 155713, 306: 155865, 307: 155779, 308: 155837, 309: 155812, 310: 155817, 311: 155688, 312: 155850, 313: 155895, 314: 155733, 315: 155740, 316: 155966, 317: 155797, 318: 155857, 319: 155827, 320: 155829, 321: 155704, 322: 155885, 323: 155924, 324: 155752, 325: 155759, 326: 155980, 327: 155811, 328: 155873, 329: 155833, 330: 155842, 331: 155711, 332: 155898, 333: 155933, 334: 155768, 335: 155771, 336: 156009, 337: 155825, 338: 155905, 339: 155844, 340: 155862, 341: 155738, 342: 155911, 343: 155952, 344: 155775, 345: 155789, 346: 156039, 347: 155848, 348: 155930, 349: 155861, 350: 155880, 351: 155754, 352: 155921, 353: 155965, 354: 155791, 355: 155808, 356: 156048, 357: 155875, 358: 155946, 359: 155881, 360: 155901, 361: 155777, 362: 155939, 363: 156225, 364: 155804, 365: 155855, 366: 156183, 367: 155887, 368: 155970, 369: 155903, 370: 155941, 371: 155795, 372: 155957, 373: 156243, 374: 155821, 375: 155877, 376: 156206, 377: 155891, 378: 155984, 379: 155919, 380: 155959, 381: 155806, 382: 155982, 383: 155177, 384: 155841, 385: 155894, 386: 156219, 387: 155907, 388: 156000, 389: 155943, 390: 155968, 391: 155823, 392: 155997, 393: 155188, 394: 155859, 395: 155915, 396: 156241, 397: 155917, 398: 156002, 399: 155954, 400: 155985, 401: 155831, 402: 156031, 403: 155203, 404: 155870, 405: 155931, 406: 155181, 407: 155935, 408: 156026, 409: 155973, 410: 156003, 411: 155839, 412: 156047, 413: 155228, 414: 155883, 415: 155944, 416: 155192, 417: 155948, 418: 156029, 419: 156007, 420: 156017, 421: 155852, 422: 156062, 423: 155238, 424: 155909, 425: 155961, 426: 155217, 427: 155995, 428: 156043, 429: 156021, 430: 156033, 431: 155868, 432: 156080, 433: 155258, 434: 155926, 435: 155991, 436: 155234, 437: 156012, 438: 156064, 439: 156041, 440: 156056, 441: 155889, 442: 156111, 443: 155274, 444: 155950, 445: 156024, 446: 155311, 447: 156037, 448: 156078, 449: 156058, 450: 156074, 451: 155899, 452: 156135, 453: 155296, 454: 155960, 455: 156027, 456: 155322, 457: 156051, 458: 156120, 459: 156068, 461: 155922, 462: 156151, 463: 155477, 464: 155975, 465: 156045, 466: 155327, 467: 156072, 468: 156133, 469: 156102, 470: 156118, 471: 155928, 472: 156177, 473: 155504, 474: 155987, 475: 156050, 476: 155335, 477: 156122, 478: 156146, 479: 156139, 480: 156127, 481: 155937, 482: 156192, 483: 155524, 484: 155999, 485: 156060, 486: 155353, 487: 156130, 488: 156160, 489: 156156, 490: 156142, 491: 155963, 492: 156210, 493: 155542, 494: 156011, 495: 156076, 496: 155361, 497: 156158, 498: 156179, 499: 156166, 500: 156153, 501: 155978, 502: 156227, 503: 155544, 504: 156019, 505: 156084, 506: 155375, 507: 156168, 508: 156203, 509: 156176, 510: 156164, 511: 155993, 512: 156234, 513: 155550, 514: 156035, 515: 156107, 516: 155391, 517: 156193, 518: 156221, 519: 156187, 520: 156172, 521: 155998, 522: 156245, 523: 155575, 524: 156604, 525: 156116, 526: 155414, 527: 155169, 528: 156247, 529: 156200, 530: 156190, 531: 156005, 532: 156248, 533: 155585, 534: 156069, 535: 156124, 536: 155427, 537: 155184, 538: 156252, 539: 156222, 540: 156208, 541: 156015, 542: 156255, 543: 155596, 544: 156082, 545: 156125, 546: 155433, 547: 155197, 548: 156260, 549: 156237, 550: 156213, 551: 156605, 552: 155175, 553: 155628, 554: 156109, 555: 156144, 556: 155454, 557: 155226, 558: 155222, 559: 155167, 560: 156229, 561: 156054, 562: 155211, 563: 155640, 564: 156132, 565: 156174, 566: 156606, 567: 155231, 568: 155239, 570: 155171, 571: 156066, 572: 155233, 573: 155663, 574: 156148, 575: 156189, 576: 155515, 577: 155250, 579: 155209, 580: 155201, 581: 156105, 582: 155242, 583: 155674, 584: 156162, 585: 156198, 586: 155522, 587: 155252, 588: 155269, 589: 155215, 590: 155220, 591: 156114, 592: 155255, 593: 155691, 594: 156181, 595: 156215, 596: 155545, 597: 155278, 598: 155280, 599: 155241, 600: 155236, 601: 156137, 602: 155272, 603: 155710, 604: 156185, 605: 156232, 606: 155556, 607: 155291, 608: 155295, 609: 155253, 610: 155261, 611: 156141, 612: 155286, 613: 155737, 614: 156195, 615: 156239, 616: 155583, 617: 155320, 618: 155300, 619: 155276, 620: 155284, 621: 156154, 622: 155298, 623: 155746, 624: 156231, 625: 156258, 626: 155611, 628: 155307, 629: 155304, 630: 155303, 631: 156170, 632: 155318, 633: 156607, 634: 156236, 635: 155183, 636: 155630, 637: 155346, 638: 155325, 639: 155337, 640: 155314, 641: 156197, 642: 155342, 643: 155776, 644: 156251, 645: 155190, 646: 155639, 647: 155356, 648: 155344, 649: 155363, 650: 155324, 651: 156211, 652: 155367, 653: 155800, 654: 156256, 655: 155205, 656: 155645, 657: 155369, 658: 155359, 659: 155393, 660: 155348, 661: 156249, 662: 155398, 663: 155813, 664: 155173, 665: 155213, 666: 155654, 667: 155389, 668: 155387, 669: 155415, 670: 155365, 671: 155179, 672: 155412, 673: 155818, 674: 155194, 675: 155224, 676: 155677, 677: 155401, 678: 155403, 679: 155441, 680: 155380, 681: 155186, 682: 155423, 683: 155822, 684: 155200, 685: 155248, 686: 155684, 687: 155425, 688: 155421, 689: 155446, 690: 155385, 691: 155196, 692: 155443, 693: 155832, 694: 155219, 695: 155256, 696: 155692, 697: 155450, 698: 155439, 699: 155465, 700: 155406, 701: 155207, 702: 155461, 703: 155840, 704: 155244, 705: 155271, 706: 155702, 707: 155480, 708: 155453, 709: 155476, 710: 155410, 711: 155246, 712: 155469, 713: 155872, 714: 155267, 715: 155282, 716: 155718, 717: 155489, 718: 155474, 719: 155493, 720: 155438, 721: 155265, 722: 155503, 723: 155882, 724: 155293, 725: 155288, 726: 155732, 727: 155500, 728: 155487, 729: 155511, 730: 155463, 731: 155289, 732: 155506, 733: 155916, 734: 155301, 736: 155748, 737: 155517, 738: 155518, 739: 155520, 740: 155472, 741: 155306, 742: 155528, 743: 155934, 744: 155316, 745: 155309, 746: 155765, 747: 155531, 748: 155554, 749: 155562, 750: 155484, 751: 155313, 752: 155552, 753: 155953, 754: 155331, 755: 155351, 756: 155767, 757: 155538, 758: 155582, 759: 155568, 760: 155494, 761: 155329, 762: 155571, 763: 155956, 764: 155333, 765: 155372, 766: 155785, 767: 155566, 768: 155590, 769: 155578, 770: 155513, 771: 155358, 772: 155593, 773: 155962, 774: 155350, 775: 155381, 776: 155810, 777: 155589, 778: 155594, 779: 155601, 780: 155536, 781: 155378, 782: 155609, 783: 155977, 784: 155374, 785: 155400, 786: 155820, 787: 155625, 788: 155622, 789: 155607, 790: 155560, 791: 155396, 792: 155618, 793: 155992, 794: 155383, 795: 155435, 796: 155826, 797: 155632, 798: 155651, 799: 155616, 800: 155570, 801: 155418, 802: 155623, 803: 156013, 804: 155405, 805: 155456, 806: 155845, 807: 155649, 808: 155659, 809: 155636, 810: 155580, 811: 155419, 812: 155656, 813: 156023, 814: 155408, 815: 155491, 816: 155854, 817: 155671, 818: 155694, 819: 155644, 820: 155604, 821: 155429, 822: 155672, 823: 156038, 824: 155431, 825: 155508, 826: 155866, 827: 155687, 828: 155720, 829: 155653, 830: 155614, 831: 155445, 832: 155705, 833: 156057, 834: 155448, 835: 155534, 836: 155869, 837: 155714, 838: 155734, 839: 155669, 840: 155638, 841: 155471, 842: 155712, 843: 156067, 844: 155467, 845: 156608, 846: 155879, 847: 155730, 848: 155756, 849: 155681, 850: 155661, 851: 155496, 852: 155728, 853: 156085, 854: 155482, 855: 155547, 856: 155910, 857: 155742, 858: 155860, 859: 155697, 860: 155689, 861: 155533, 862: 155762, 863: 156094, 864: 155498, 865: 155587, 866: 155923, 867: 155751, 868: 155876, 869: 156609, 870: 155706, 871: 155549, 872: 155780, 873: 156103, 874: 155526, 875: 155606, 876: 155951, 877: 155778, 878: 155902, 879: 155744, 880: 155725, 881: 155564, 882: 155805, 883: 156112, 884: 155540, 885: 155612, 886: 155969, 887: 155787, 888: 155914, 889: 155750, 890: 155753, 891: 155576, 892: 155824, 893: 156123, 894: 155558, 895: 155642, 896: 155979, 897: 155798, 898: 155932, 899: 155769, 900: 155770, 901: 155598, 902: 155851, 903: 156147, 904: 155603, 905: 155657, 906: 155988, 907: 155843, 908: 155940, 909: 155792, 910: 155794, 911: 155634, 912: 155893, 913: 156163, 914: 155620, 915: 155695, 916: 156006, 917: 155858, 918: 155942, 919: 155816, 920: 155809, 921: 155667, 922: 155925, 923: 156199, 924: 155648, 925: 155717, 926: 156014, 927: 155884, 928: 155976, 929: 155836, 930: 156610, 931: 155678, 932: 155938, 933: 156217, 934: 155665, 935: 155726, 936: 156034, 937: 155897, 938: 156008, 939: 155849, 940: 155834, 941: 155698, 942: 155949, 943: 156233, 944: 155683, 945: 155755, 946: 156049, 947: 155906, 948: 156036, 949: 155871, 950: 155863, 951: 155722, 952: 155971, 953: 156253, 954: 155700, 955: 155774, 956: 156061, 957: 155912, 958: 156052, 959: 155900, 960: 155874, 961: 155723, 962: 156004, 963: 156264, 964: 155708, 965: 155783, 966: 156071, 967: 155918, 968: 156053, 969: 155913, 970: 155890, 971: 155736, 972: 156025, 973: 156279, 974: 155739, 975: 155803, 976: 156090, 977: 155945, 978: 156065, 979: 155947, 980: 155908, 981: 155758, 982: 156042, 983: 156288, 984: 155760, 985: 155828, 986: 156091, 988: 156081, 989: 155964, 990: 155936, 991: 155772, 992: 156077, 993: 156294, 994: 155782, 995: 155838, 996: 156100, 997: 155974, 998: 156092, 999: 155983, 1000: 155955, 1001: 155790, 1002: 156093, 1003: 156296, 1004: 155788, 1005: 155853, 1006: 156108, 1007: 155981, 1008: 156098, 1009: 155996, 1010: 155972, 1011: 155796, 1012: 156126, 1013: 156305, 1014: 155807, 1015: 155867, 1016: 156131, 1017: 155990, 1018: 156128, 1019: 156016, 1020: 156001, 1021: 155815, 1022: 156167, 1023: 156312, 1024: 155847, 1025: 155878, 1026: 156182, 1027: 156018, 1028: 156140, 1029: 156046, 1030: 156010, 1031: 155830, 1032: 156191, 1033: 156327, 1034: 156611, 1035: 155888, 1036: 156216, 1037: 156028, 1038: 156159, 1039: 156063, 1040: 156020, 1041: 155856, 1042: 156209, 1043: 156334, 1044: 155886, 1045: 155904, 1046: 156228, 1047: 156040, 1048: 156178, 1049: 156083, 1050: 156030, 1051: 155864, 1052: 156224, 1053: 156339, 1054: 155896, 1055: 155920, 1056: 156246, 1057: 156073, 1058: 156196, 1059: 156097, 1060: 156032, 1061: 155892, 1062: 156235, 1063: 156347, 1064: 155927, 1065: 155986, 1066: 156274, 1067: 156088, 1068: 156212, 1069: 156121, 1070: 156070, 1071: 155929, 1072: 156277, 1073: 156356, 1074: 155967, 1075: 155989, 1076: 156286, 1077: 156101, 1078: 156250, 1079: 156145, 1080: 156095, 1081: 155958, 1082: 156316, 1083: 156364, 1084: 155994, 1085: 156055, 1086: 156307, 1087: 156113, 1088: 156268, 1089: 156152, 1090: 156110, 1091: 156079, 1092: 156323, 1093: 156374, 1094: 156022, 1095: 156075, 1096: 156310, 1097: 156129, 1098: 156271, 1099: 156171, 1100: 156138, 1101: 156106, 1102: 156333, 1103: 156388, 1104: 156044, 1105: 156096, 1106: 156315, 1107: 156155, 1108: 156283, 1109: 156186, 1110: 156161, 1111: 156117, 1112: 156351, 1113: 156391, 1114: 156059, 1115: 156104, 1116: 156321, 1117: 156173, 1118: 156285, 1119: 156202, 1120: 156169, 1121: 156136, 1122: 156359, 1123: 156399, 1124: 156086, 1125: 156143, 1126: 156326, 1127: 156300, 1128: 156293, 1129: 156223, 1130: 156188, 1131: 156157, 1132: 156368, 1133: 156406, 1134: 156089, 1135: 156150, 1136: 156332, 1137: 156306, 1138: 156299, 1139: 156242, 1140: 156205, 1141: 156175, 1142: 156376, 1143: 156410, 1144: 156099, 1145: 156165, 1146: 156337, 1147: 156313, 1148: 156304, 1149: 156254, 1150: 156218, 1151: 156201, 1152: 156383, 1153: 156414, 1154: 156115, 1155: 156184, 1156: 156341, 1157: 156322, 1158: 156309, 1159: 156263, 1160: 156244, 1161: 156204, 1162: 156389, 1163: 156431, 1164: 156119, 1165: 156214, 1166: 156352, 1167: 156338, 1168: 156311, 1169: 156272, 1170: 156262, 1171: 156220, 1172: 156395, 1173: 156439, 1174: 156134, 1175: 156226, 1176: 156360, 1177: 156344, 1178: 156320, 1179: 156275, 1180: 156267, 1181: 156238, 1182: 156402, 1183: 156450, 1184: 156149, 1185: 156240, 1186: 156370, 1187: 156349, 1188: 156328, 1189: 156284, 1190: 156273, 1191: 156261, 1192: 156405, 1193: 156454, 1194: 156180, 1195: 156257, 1196: 156373, 1197: 156361, 1198: 156336, 1199: 156291, 1200: 156282, 1201: 156265, 1202: 156412, 1203: 156458, 1204: 156194, 1205: 156266, 1206: 156387, 1207: 156367, 1208: 156340, 1209: 156295, 1210: 156290, 1211: 156270, 1212: 156419, 1213: 156463, 1214: 156207, 1215: 156278, 1216: 156397, 1217: 156375, 1218: 156346, 1219: 156301, 1220: 156297, 1221: 156276, 1222: 156427, 1223: 156466, 1224: 156230, 1225: 156287, 1226: 156409, 1227: 156386, 1228: 156350, 1229: 156314, 1230: 156303, 1231: 156292, 1232: 156434, 1233: 156475, 1234: 156259, 1235: 156302, 1236: 156422, 1237: 156400, 1238: 156358, 1239: 156331, 1240: 156318, 1241: 156308, 1243: 156492, 1244: 156269, 1245: 156319, 1246: 156451, 1247: 156418, 1248: 156379, 1249: 156357, 1250: 156345, 1251: 156325, 1252: 156445, 1253: 156500, 1254: 156280, 1255: 156343, 1256: 156462, 1257: 156447, 1258: 156398, 1259: 156371, 1260: 156348, 1261: 156329, 1262: 156452, 1263: 156504, 1264: 156281, 1265: 156353, 1266: 156467, 1267: 156460, 1268: 156415, 1269: 156392, 1270: 156354, 1271: 156335, 1272: 156455, 1273: 156512, 1274: 156289, 1275: 156365, 1276: 156476, 1277: 156468, 1278: 156424, 1279: 156411, 1280: 156363, 1281: 156362, 1282: 156461, 1283: 156515, 1284: 156298, 1285: 156377, 1286: 156487, 1287: 156471, 1288: 156428, 1289: 156421, 1290: 156381, 1291: 156369, 1292: 156470, 1293: 156519, 1294: 156317, 1295: 156380, 1296: 156494, 1297: 156490, 1298: 156442, 1299: 156432, 1300: 156384, 1301: 156378, 1302: 156485, 1303: 156530, 1304: 156324, 1306: 156501, 1307: 156509, 1308: 156448, 1309: 156437, 1310: 156393, 1311: 156385, 1312: 156538, 1313: 156531, 1314: 156330, 1315: 156407, 1316: 156510, 1317: 156516, 1318: 156469, 1319: 156453, 1320: 156396, 1321: 156394, 1322: 156545, 1323: 156537, 1324: 156342, 1325: 156420, 1326: 156517, 1327: 156521, 1328: 156474, 1329: 156465, 1330: 156404, 1331: 156401, 1332: 156550, 1333: 156539, 1334: 156355, 1335: 156429, 1336: 156524, 1337: 156527, 1338: 156481, 1339: 156472, 1340: 156416, 1341: 156408, 1342: 156554, 1343: 156541, 1344: 156366, 1345: 156438, 1346: 156529, 1348: 156486, 1349: 156478, 1350: 156423, 1351: 156425, 1352: 156561, 1353: 156551, 1354: 156372, 1355: 156444, 1356: 156536, 1357: 156534, 1358: 156497, 1359: 156482, 1360: 156435, 1361: 156433, 1362: 156572, 1363: 156560, 1364: 156382, 1365: 156459, 1366: 156548, 1367: 156547, 1368: 156506, 1369: 156491, 1370: 156449, 1371: 156443, 1372: 156579, 1373: 156564, 1374: 156390, 1375: 156473, 1376: 156557, 1377: 156558, 1378: 156523, 1379: 156498, 1380: 156456, 1381: 156457, 1382: 156584, 1383: 156568, 1384: 156403, 1385: 156479, 1386: 156565, 1387: 156562, 1388: 156535, 1389: 156507, 1390: 156464, 1391: 156480, 1392: 156592, 1393: 156574, 1394: 156413, 1395: 156483, 1396: 156567, 1397: 156566, 1398: 156540, 1399: 156513, 1400: 156477, 1401: 156488, 1402: 156593, 1403: 156578, 1404: 156417, 1405: 156489, 1406: 156569, 1407: 156570, 1408: 156543, 1409: 156514, 1410: 156484, 1411: 156499, 1412: 156594, 1413: 156580, 1414: 156426, 1415: 156493, 1416: 156573, 1417: 156571, 1418: 156546, 1419: 156520, 1420: 156495, 1421: 156503, 1422: 156595, 1423: 156583, 1424: 156430, 1425: 156502, 1426: 156576, 1427: 156575, 1428: 156549, 1429: 156525, 1430: 156496, 1431: 156542, 1432: 156596, 1433: 156585, 1434: 156436, 1435: 156612, 1436: 156581, 1437: 156577, 1438: 156553, 1439: 156526, 1440: 156505, 1441: 156544, 1442: 156598, 1443: 156588, 1444: 156440, 1445: 156511, 1446: 156586, 1447: 156582, 1448: 156555, 1449: 156528, 1450: 156508, 1451: 156552, 1452: 156599, 1455: 156518, 1456: 156590, 1457: 156587, 1458: 156559, 1459: 156532, 1461: 156556, 1464: 156441, 1465: 156522, 1466: 156597, 1467: 156589, 1468: 156563, 1469: 156533, 1472: 156600, 1473: 156591, 1474: 156446, 1478: 156613
                       }


    # map_post_ssn_id = {y: x for x, y in map_post_id_ssn.iteritems()}
    post_id = map_post_ssn_id.get(ssn, 0)
    return post_id

def get_sheets_from_get_server(list_get_sheet_ids, get_server_address):
    got_sheets = []
    for id in list_get_sheet_ids:
        url = get_server_address + "/api/sheets/{}".format(id)
        got = http_request(url, body={"apikey": API_KEY}, method="GET")
        got_sheets.append(got)
    return got_sheets
    
def link_sheet(sheet_json, get_ssn_map,post_id=None):
    """

    :param sheet_json: the guts of a sheet
    :param post_id: an option to post the sheet over a different sheet that is on the server and not back over the original
    :return: returns the new (fixed links for the server) sheet_json
    """
    if not post_id:
        post_id=sheet_json['id']

    for i, s in enumerate(sheet_json['sources']):
        compile = re.compile(u'/sheets/(?P<id>\d+)')  # (?:\.(?P<node>\d+))? # there is a proble, here. it returns/ or reads only the first see. ssn 911. id 552
        if 'outsideText' in s.keys():
            uni_outsidetext = unicode(s['outsideText'], encoding='utf8') if isinstance(s['outsideText'], str) else s[
                'outsideText']
            for match in re.finditer(compile, s['outsideText']):
                ssn = get_ssn(match.group("id"),get_ssn_map)  # this is the ssn of the sheet to connect to
                print ssn
                to_post_id = get_post_id(ssn)
                s['outsideText'] = re.sub(match.group("id"), str(to_post_id), s['outsideText'])
                print s['outsideText']
        elif 'outsideBiText' in s.keys():
            uni_outsidetext = unicode(s['outsideBiText']['he'], encoding='utf8') if isinstance(s['outsideBiText']['he'],
                                                                                               str) else \
                s['outsideBiText']['he']
            for match in re.finditer(compile, s['outsideBiText']['he']):
                ssn = get_ssn(match.group("id"),get_ssn_map)  # this is the ssn of the sheet to connect to
                print ssn
                to_post_id = get_post_id(ssn)
                s['outsideBiText']['he'] = re.sub(match.group("id"), str(to_post_id), s['outsideBiText']['he'])
                print s['outsideBiText']['he']
            # matched = re.search(compile, s['outsideBiText'])
            # if matched:
            #     ssn = get_ssn(matched.group("id"))
            #     to_post_id = get_post_id(ssn)
            #     new_link = re.sub(compile, u'/sheets/{}'.format(to_post_id), s['outsideText'])
            #     s['outsideBiText'] = re.sub(compile, u'/sheets/\g<id>', new_link)  # todo: check and then test this line
    del sheet_json['_id']
    sheet_json['id'] = post_id
    return sheet_json

if __name__ == "__main__":
    #use list of which sheets have links which has sheet title and sheet year and tags
    #for each sheet, get each segment and check if it has
    sheet_data = []
    # sheets = db.sheets.find({"tags": "Hebrew Sheet"})
    compile = re.compile(u'/sheets/(?P<id>\d+)')  # (?:\.(?P<node>\d+))?
    get_ssn_map = revers_get_map()
    sheets = get_sheets_from_get_server(range(155500, 156614), GET_SERVER)  # list_get_sheet_ids comes straight from mongo range(155157, 156614)
    progress = 0
    for sheet_json in sheets:
        print sheet_json['id']
        linked_json = link_sheet(sheet_json, get_ssn_map)  #, post_id=256)
        # if linked_json == sheet_json:
        #     continue
        linked_json = change_sheet(linked_json, del_tags=["UI"])
        post_sheet(linked_json, POST_SERVER)
        progress += 1
        print "progress: {}".format(progress)
    # for x in range(21, 1471, 10):
    #     sheets = get_sheets_from_get_server(range(x, x+10), GET_SERVER)  # list_get_sheet_ids comes straight from mongo
    #     for sheet_json in sheets:
    #         link_sheet(sheet_json)
    #         post_sheet(sheet_json, POST_SERVER)
    # # for title_year_tags in sheet_data:
    # #     title, year, tags = title_year_tags
    # #     sheet = db.sheets.find({"title": title, "summary": year, "tags": tags})
    # #     assert sheet, u"Couldn't find sheet {}".format(title)
    # #     for segment in sheet["sources"]:
    # #         text = segment["text"]["he"] if "text" in segment.keys() else segment["outsideText"]
    # #         for match in re.findall("^<a href.*?nechama.org.il/pages/.*?</a>", text):
    # #             text = text.replace(match, )



